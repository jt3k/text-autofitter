<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="UTF-8">
    <title>Text-autofitter by jt3k</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="stylesheets/normalize.css" media="screen">
    <link href='http://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/github-light.css" media="screen">
  </head>
  <body>
    <section class="page-header">
      <h1 class="project-name">Text-autofitter</h1>
      <h2 class="project-tagline">The function returns the font size for text to fit in the width of the container</h2>
      <a href="https://github.com/jt3k/text-autofitter" class="btn">View on GitHub</a>
      <a href="https://github.com/jt3k/text-autofitter/zipball/master" class="btn">Download .zip</a>
      <a href="https://github.com/jt3k/text-autofitter/tarball/master" class="btn">Download .tar.gz</a>
    </section>

    <section class="main-content">
      <div class="af">
        <h2>Dirty implementation</h2>
        <meta name="robots" content="noindex"><head><script src="//jashkenas.github.io/underscore/underscore-min.js"></script>

        <style>
        .af * {
          line-height: 1;
        }
        .af textarea {
          display: block;
          margin: auto;
          text-align: center;
          width: 298px;
          padding: 0;
        }
        .af #range {
          width: 90%;
          float: left;
          padding: 0;
          margin: 0;
        }
        .af #range-val {
          float: right;
          width: 10%;
          text-align: right;
        }
        .af p {
          margin: 0;
        }
        .af p span {
          vertical-align: top;
        }
        .af #output {
          -webkit-transition: 1s;
          -o-transition: 1s;
          transition: 1s;
          clear: both;
          transform: translateX(-50%);
          position: relative;
          left: 50%;
          margin-top: 1em;
        }
        </style>

        <textarea id="input" rows="7">
        dikk
        starr
        djighurdaa
        </textarea>

        <input type="range" id="range" name="" min="40" max="4000" value="300" step="1">

        <div id="range-val"></div>
        <div id="output"></div>
        <script>
        ///helpers
        function hashFunc() {
          // not really an efficient hash function
          return JSON.stringify(arguments);
        }

        /*На входе:
           1) текстовая строка,
           2) ширина блока куда она должна уместиться,
           3) стиль текстовой строки (все параметры не обязательны).
        На выходе:
           шрифт при котором текстовая строка(text) влезет в блок шириной(width)
        */
        var si = function(opt) {
          //   opt = {
          //     text: '',
          //     wishfulWidth: 300,
          //     styleObj: {}
          //   };

        //   console.log('noCache');
          if (!opt) {
            return;
          }

          var widthFromSize = function(line, size) {
              line.style.fontSize = size + 'px';
              return line.offsetWidth;
            },
            line = document.createElement('span'),
            width, k, resultWidth;

          //default values in attributes
          var textNode = document.createTextNode(opt.text || 'example');
          opt.wishfulWidth = opt.wishfulWidth || 300;
          opt.styleObj = _.extend({}, {
            'whiteSpace': 'nowrap',
            'fontFamily': 'sans-serif'
          }, opt.styleObj);


          line.appendChild(textNode);
          appendStyle(line, opt.styleObj);
          document.body.appendChild(line);

          //при шрифте 100px делим ширину строки на размер гарнитуры
          k = widthFromSize(line, 100) / 100;

          //получаем требуемый размер шрифта 
          resultWidth = (opt.wishfulWidth - 1) / k;

          document.body.removeChild(line);
          return resultWidth;
        };

        //делаем функцию запоминающей
        si = _.memoize(si, hashFunc);
        //console.log(si('проверко',200)); //вернёт какого размера должен быть текст чтобы уместиться в ширину 200


        //
        function appendStyle(el, styleObj) {
          for (var i in styleObj) {
            if (styleObj.hasOwnProperty(i)) {
              el.style[i] = styleObj[i];
            }
          }
        }

        var helpe = function(arr, style, width) {
          //var crP = function(){ return document.CreateElement('p')}
          var p, span;
          var obj = document.createElement('div');
          obj.id = 'lalala';
          //   obj.style.lineHeight = 1;
          if (typeof arr === 'string' && arr.length) {
            arr = arr.split('\n');
          } else { //if empty
            return obj;
          }

          var stylesForSi = _.pick(style, function(val, key) {
            return /font|letter/.test(key);
          });

          for (var i in arr) {
            span = document.createElement('span');
            p = document.createElement('p');
            p.style.textAlign = 'center';
            p.style.margin = '0';
            p.appendChild(span);

            span.appendChild(document.createTextNode(arr[i]));
            style.fontSize = si({
              text: arr[i],
              wishfulWidth: width,
              styleObj: stylesForSi
            }) + 'px';
            style.backgroundColor = '#' + Math.random().toString(16).slice(-6);
            style.color = '#' + Math.random().toString(16).slice(-6);

            appendStyle(span, style);

            obj.appendChild(p);
          }
          return obj;
        };


        //psdz

        var psdz = function(text, width) {
          //options
          var styleObj = {
              "fontFamily": 'serif',
              "fontWeight": 'bold',
              "letterSpacing": '-.07em',
              "fontStyle": 'italic',
              "white-space": 'nowrap'
            },
            o = document.getElementById('output');
          o.innerHTML = '';
          o.appendChild(helpe(text, styleObj, width));
        };

        //psdz = _.debounce(psdz, 150);

        var range = document.getElementById('range');
        var rangeVal = document.getElementById('range-val');
        var inp = document.getElementById('input');
        inp.oninput = range.oninput = function() {
          psdz(inp.value, range.value);
          rangeVal.innerHTML = range.value;
        };

        // psdz(inp.value, range.value);
        inp.oninput();
        </script>


      </div>

      <footer class="site-footer">
        <span class="site-footer-owner"><a href="https://github.com/jt3k/text-autofitter">Text-autofitter</a> is maintained by <a href="https://github.com/jt3k">jt3k</a>.</span>

        <span class="site-footer-credits">This page was generated by <a href="https://pages.github.com">GitHub Pages</a> using the <a href="https://github.com/jasonlong/cayman-theme">Cayman theme</a> by <a href="https://twitter.com/jasonlong">Jason Long</a>.</span>
      </footer>

    </section>

            <script type="text/javascript">
            var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
            document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
          </script>
          <script type="text/javascript">
            try {
              var pageTracker = _gat._getTracker("UA-65883489-1");
            pageTracker._trackPageview();
            } catch(err) {}
          </script>

  </body>
</html>

